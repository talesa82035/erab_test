@固有アビ_33_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 効果数値
#DIM 消費ＭＰ
#DIMS アビ名

IF スタイル判定関数(キャラ番号, "デフォルト") == 0 && スタイル判定関数(キャラ番号, "[永遠の親愛]ユエル＆ソシエ") == 0
	アビ名 = 
	RETURN 0
ENDIF

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 45
	アビ名 = 紅蓮＋＋
	効果数値 = 350
	消費ＭＰ = 150
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 20
	アビ名 = 紅蓮＋
	効果数値 = 300
	消費ＭＰ = 90
ELSE
	アビ名 = 紅蓮
	効果数値 = 250
	消費ＭＰ = 75
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵全体に［攻撃力✕{効果数値}％］の自属性ダメージを与える。<br>
		詳細文文字列受け渡し変数 += @"［1％］（3ターン・消去不可）の狐火効果を与える。"
		IF アビ名 == "紅蓮＋＋"
			詳細文文字列受け渡し変数 += @"味方全体に［30％］（Ａ枠・3ターン）のDA率上昇効果を与える。"
			詳細文文字列受け渡し変数 += @"［20％］（Ａ枠・3ターン）の追撃効果を与える。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵全体に［攻撃力✕{効果数値}％］の自属性ダメージを与える。<br>
		詳細文文字列受け渡し変数 += @"［1％］（3ターン・消去不可）の狐火効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>（狐火："
		詳細文文字列受け渡し変数 += @"<br>　火傷効果互換の独自枠デバフ）"
		IF アビ名 == "紅蓮＋＋"
			詳細文文字列受け渡し変数 += @"味方全体に［30％］（Ａ枠・3ターン）のDA率上昇効果を与える。"
			詳細文文字列受け渡し変数 += @"［20％］（Ａ枠・3ターン）の追撃効果を与える。"
		ENDIF
	CASE "アビ効果"
;全体ダメージ処理
	CALL アビ対象選択テンプレート_敵全体_生者のみ
	アビ汎用変数:効果割合 = 効果数値
	CALL アビテンプレート_ダメージ処理_自属性
;狐火
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 狐火
	アビ汎用文字列:バフ・デバフ対象能力 = 火傷
	アビ汎用変数:効果割合 = 1
	アビ汎用変数:持続ターン = 3
	アビ汎用変数:基礎成功確率 = 100
	アビ汎用変数:消去不可オプション = 1
	CALL アビテンプレート_不利効果_デバフ効果セット
;味方全体にDA30 TA15 追撃20 3T
	IF アビ名 == "紅蓮＋＋"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = DA率A
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果割合 = 30
		アビ汎用変数:持続ターン = 3
		CALL アビテンプレート_有利効果_バフ効果セット
;		アビ汎用文字列:バフ・デバフ枠 = TA率A
;		アビ汎用文字列:バフ・デバフ対象能力 = TA率
;		アビ汎用変数:効果割合 = 15
;		CALL アビテンプレート_有利効果_バフ効果セット
		アビ汎用文字列:バフ・デバフ枠 = 追撃A
		アビ汎用文字列:バフ・デバフ対象能力 = 追撃
		アビ汎用変数:効果割合 = 20
		CALL アビテンプレート_有利効果_バフ効果セット
	ENDIF
ENDSELECT

@固有アビ_33_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 効果数値
#DIM ダメージ回数
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 攻撃対象一時退避

IF スタイル判定関数(キャラ番号, "デフォルト") == 0 && スタイル判定関数(キャラ番号, "[永遠の親愛]ユエル＆ソシエ") == 0
	アビ名 = 
	RETURN 0
ENDIF

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 40
	アビ名 = 燕返し＋＋
	効果数値 = 80
	ダメージ回数 = 4
	消費ＭＰ = 80
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 24
	アビ名 = 燕返し＋
	効果数値 = 80
	ダメージ回数 = 3
	消費ＭＰ = 60
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 8
	アビ名 = 燕返し
	効果数値 = 80
	ダメージ回数 = 2
	消費ＭＰ = 40
ELSE
	アビ名 = 
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に［攻撃力✕{効果数値}％］の自属性ダメージを{ダメージ回数}回与える。<br>
		詳細文文字列受け渡し変数 += "自身に［累積20％上限60％］（累積枠）の攻撃力上昇効果を与える。<br>"
		詳細文文字列受け渡し変数 += "［累積20％上限60％］（累積枠）のDA率上昇効果を与える。<br>"
		詳細文文字列受け渡し変数 += "攻撃対象に狐火効果が存在する場合、このアビリティは2回発動する。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
	CALL アビ対象選択テンプレート_敵単体
	攻撃対象一時退避 = アビテンプレート用_対象保存:0
	IF デバフ番号取得_枠("狐火", 攻撃対象一時退避) >= 0
		CALL ユエル2アビダメージ処理(攻撃対象一時退避, 効果数値, ダメージ回数)
		CALL ユエル2アビバフ処理
	ENDIF
	CALL ユエル2アビダメージ処理(攻撃対象一時退避, 効果数値, ダメージ回数)
	CALL ユエル2アビバフ処理
ENDSELECT

@ユエル2アビダメージ処理(攻撃対象, 効果数値, ダメージ回数)
#DIM 攻撃対象
#DIM 効果数値
#DIM ダメージ回数
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_指定(攻撃対象)
	アビ汎用変数:効果割合 = 効果数値
	FOR LOCAL:1, 0, ダメージ回数
		CALL アビテンプレート_ダメージ処理_自属性
	NEXT
	CALL アビ汎用変数文字列リセット

@ユエル2アビバフ処理
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ枠 = 攻撃力累積
	アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
	アビ汎用変数:効果割合 = 20
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:累積上限_割合 = 60
	CALL アビテンプレート_有利効果_累積バフ効果セット

	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = DA率累積
	アビ汎用文字列:バフ・デバフ対象能力 = DA率
	アビ汎用変数:効果割合 = 20
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:累積上限_割合 = 60
	CALL アビテンプレート_有利効果_累積バフ効果セット
	
;	CALL アビ汎用変数文字列リセット
;	アビ汎用文字列:バフ・デバフ枠 = TA率_累積
;	アビ汎用文字列:バフ・デバフ対象能力 = TA率
;	アビ汎用変数:効果割合 = 10
;	アビ汎用変数:持続ターン = -1
;	アビ汎用変数:累積上限_割合 = 30
;	CALL アビテンプレート_有利効果_累積バフ効果セット
	
@固有アビ_33_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

IF スタイル判定関数(キャラ番号, "デフォルト") == 0 && スタイル判定関数(キャラ番号, "[永遠の親愛]ユエル＆ソシエ") == 0
	アビ名 = 
	RETURN 0
ENDIF

;初期状態で習得しない場合は以下のようにする
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 18
	アビ名 = 迎暁の儀
	消費ＭＰ = 60
ELSE
	アビ名 = 
ENDIF


SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>味方全体に［回復力✕120％］のＨＰ回復を与える。
		詳細文文字列受け渡し変数 += "<br>［1］のデバフ消去を与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用変数:効果割合 = 120
	CALL アビテンプレート_回復処理_MAXでも回復
	CALL アビテンプレート_有利効果_デバフ消去()
;120ヒール
;クリア

ENDSELECT

@固有アビ_33_4(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

IF スタイル判定関数(キャラ番号, "デフォルト") == 0 && スタイル判定関数(キャラ番号, "[永遠の親愛]ユエル＆ソシエ") == 0
	アビ名 = 
	RETURN 0
ENDIF

;初期状態で習得しない場合は以下のようにする
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 50
	アビ名 = 参之舞･燼花
	消費ＭＰ = 100
ELSE
	アビ名 = 
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に通常攻撃を2回行う。
		詳細文文字列受け渡し変数 += "<br>この攻撃の間、［100％］のTA率上昇効果を与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
	CALL アビ対象選択テンプレート_敵単体
	アビ汎用変数:効果割合 = 100
	アビ汎用変数:TA率補正値 = 100
	CALL アビテンプレート_通常攻撃処理
	CALL アビテンプレート_通常攻撃処理
ENDSELECT



@探索欄表示_キャラ_33(レイヤー番号, 隊列番号)
#DIM 隊列番号
#DIM レイヤー番号

;リミテッドVerの処理は別ファイルにまとめるため、別関数を呼ぶ
IF CSTR:GETCHARA(33):スタイル管理文字列 == "[千年を超える者]ユエル"
	TRYCALL 千年を超える者探索欄表示_キャラ(レイヤー番号, 隊列番号)
	RETURN
ENDIF



@固有ターン開始時処理_キャラ_33
#DIM 対象キャラ
#DIM 対象隊列
;リミテッドVerの処理は別ファイルにまとめるため、別関数を呼ぶ
対象キャラ = GETCHARA(33)
対象隊列 = キャラ隊列検索(対象キャラ)
IF CSTR:対象キャラ:スタイル管理文字列 == "[千年を超える者]ユエル"
	TRYCALL 千年を超える者固有ターン開始時処理_キャラ
	RETURN
ENDIF



@固有通常攻撃後処理_キャラ_33(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ

;リミテッドVerの処理は別ファイルにまとめるため、別関数を呼ぶ
IF CSTR:GETCHARA(33):スタイル管理文字列 == "[千年を超える者]ユエル"
	TRYCALL 千年を超える者固有通常攻撃後処理_キャラ(全滅フラグ, 連撃数)
	RETURN
ENDIF



@固有ターン終了時処理_キャラ_33
;リミテッドVerの処理は別ファイルにまとめるため、別関数を呼ぶ
IF CSTR:GETCHARA(33):スタイル管理文字列 == "[千年を超える者]ユエル"
	TRYCALL 千年を超える者固有ターン終了時処理_キャラ
	RETURN
ENDIF


; @固有戦闘開始時処理_キャラ_33
; #DIM 対象キャラ
; #DIM 対象隊列
; 対象キャラ = GETCHARA(33)
; 対象隊列 = キャラ隊列検索(対象キャラ)

; IF キャラ隊列検索(キャラ検索("[千年を継ぎし者]ソシエ")) >= 10
; 	;ソシエが控えにいる時コンビ化
; 	CSTR:対象キャラ:スタイル管理文字列 = [永遠の親愛]ユエル＆ソシエ
; 	探索中顔グラ保存:対象隊列:通常時 = ユエソシ戦闘
; 	探索中顔グラ保存:対象隊列:奥義ゲージMAX = ユエソシ戦闘
; 	CALLNAME:対象キャラ = ユエル＆ソシエ
; 	CALL 探索用顔グラフィック生成
; ENDIF

; @固有戦闘終了時処理_キャラ_33
; #DIM 対象キャラ
; 対象キャラ = GETCHARA(33)

; ;コンビ化を戻す
; IF CSTR:対象キャラ:スタイル管理文字列 == "[永遠の親愛]ユエル＆ソシエ"
; 	;リミ時はコンビ化しないので通常に戻す
; 	CSTR:対象キャラ:スタイル管理文字列 = 
; 	CALLNAME:対象キャラ = ユエル
; ENDIF
